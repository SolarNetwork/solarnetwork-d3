!function(){"use strict";function t(){return"undefined"!=typeof self?self:"undefined"!=typeof U?U:new Function("return this")()}function e(t){var e,n,r,a,o,i,u={};if(void 0!==t&&t.length>0)for(t.match(/^\?/)&&(t=t.substring(1)),e=t.split("&"),r=0,a=e.length;a>r;r++)n=e[r].split("=",2),2===n.length&&(o=decodeURIComponent(n[0]),i=decodeURIComponent(n[1]),u[o]?(Array.isArray(u[o])||(u[o]=[u[o]]),u[o].push(i)):u[o]=i);return u}function n(t,e){var n,r;void 0===e&&(e={});for(n in t)t.hasOwnProperty(n)&&(r=Object.getOwnPropertyDescriptor(t,n),r?Object.defineProperty(e,n,r):e[n]=t[n]);return e}function r(t,e){var n,r,a,o,i=Object.getOwnPropertyNames(t);for(void 0===e&&(e={}),n=0,r=i.length;r>n;n+=1)a=i[n],o=Object.getOwnPropertyDescriptor(t,a),o?Object.defineProperty(e,a,o):e[a]=t[a];return e}function a(t,e){var n,r;if(!Array.isArray(t)||!Array.isArray(e))return!1;if(t.length!==e.length)return!1;for(n=0,r=t.length;r>n;n+=1){if(Array.isArray(t[n])&&Array.isArray(e[n])&&arraysAreEqual(t[n],e[n])!==!0)return!1;if(t[n]!==e[n])return!1}return!0}function o(t){var e=this,n=e[t];return function(){return n.apply(e,arguments)}}function i(t){var e;for(e in t)t.hasOwnProperty(e)&&void 0===env[e]&&(env[e]=t[e])}function u(t){var e;for(e in t)t.hasOwnProperty(e)&&(env[e]=t[e])}function s(t,e){"function"==typeof e&&(void 0===O&&(O=[]),t=t.replace(/[^0-9a-zA-Z_]/,""),O.push({name:t,func:e}))}function l(t){return t.hostURL()+(M.config&&M.config.solarUserPath?M.config.solarUserPath:"/solaruser")+"/api/v1/sec"}function c(t,e){"function"==typeof e&&(void 0===N&&(N=[]),t=t.replace(/[^0-9a-zA-Z_]/,""),N.push({name:t,func:e}))}function d(t){return l(this)+"/instr/view?id="+encodeURIComponent(t)}function f(){return l(this)+"/instr/viewActive?nodeId="+this.nodeId}function p(){return l(this)+"/instr/viewPending?nodeId="+this.nodeId}function m(t,e){return l(this)+"/instr/updateState?id="+encodeURIComponent(t)+"&state="+encodeURIComponent(e)}function v(t,e){var n=l(this)+"/instr/add?nodeId="+this.nodeId+"&topic="+encodeURIComponent(t);if(Array.isArray(e)){var r,a;for(r=0,a=e.length;a>r;r++)n+="&"+encodeURIComponent("parameters["+r+"].name")+"="+encodeURIComponent(e[r].name)+"&"+encodeURIComponent("parameters["+r+"].value")+"="+encodeURIComponent(e[r].value)}return n}function g(t){if(t){if(t.date)return t.date;if(t.localDate)return M.format.dateTimeFormat.parse(t.localDate+(t.localTime?" "+t.localTime:" 00:00"));if(t.created)return M.format.timestampFormat.parse(t.created)}return null}function h(){M.config.debug===!0&&void 0!==console&&console.log(M.format.fmt.apply(this,arguments))}function y(t,e,n){function r(t,e){var n=t.utc.ceil(e);return n.getTime()===e.getTime()&&(n=t.offset(n,1)),n}function a(t){var n;return n=isNaN(Number(e))?void 0!==e[t]?Number(e[t]):1:e,"number"!=typeof n&&(n=1),n}function o(t){var e=10;return 0===t.search(/^Five/)?e=5:0===t.search(/^Fifteen/)&&(e=15),e}var i,u,s,l,c;return t.search(/Minute$/)>=0?(l=a("numHours"),s="hour",i=r(d3.time.minute,n),c=o(t),i.setUTCMinutes(i.getUTCMinutes()+c-i.getUTCMinutes()%c,0,0),u=d3.time.hour.utc.offset(i,-l)):"Month"===t?(l=a("numYears"),s="year",i=r(d3.time.month,n),u=d3.time.year.utc.offset(d3.time.month.utc.floor(n),-l)):"Day"===t?(l=a("numMonths"),s="month",i=r(d3.time.day,n),u=d3.time.month.utc.offset(d3.time.day.utc.floor(n),-l)):(l=a("numDays"),s="day",i=r(d3.time.hour,n),u=d3.time.day.utc.offset(d3.time.hour.utc.floor(i),-l)),{start:u,end:i,timeUnit:s,timeCount:l}}function x(t,e){function n(e){var n,r,o=0;for(o=0;o<e.length;o+=1)r=e[o],void 0!==r.data&&void 0!==r.data.endDate?(r=r.data,void 0===n?n=r:(r.endDateMillis>n.endDateMillis&&(n.endDateMillis=r.endDateMillis,n.endDate=r.endDate),r.startDateMillis<n.startDateMillis&&(n.startDateMillis=r.startDateMillis,n.startDate=r.startDate))):M.log("No data available for {0} sources {1}",a[o].keyDescription(),t[o].sourceIds.join(","));return n}var r=queue(),a=[];!function(){var e,n,o;for(e=0;e<t.length;e+=1)o=t[e].nodeUrlHelper?t[e].nodeUrlHelper:t[e].locationUrlHelper?t[e].locationUrlHelper:t[e].urlHelper,o&&o.reportableIntervalURL&&(a.push(o),n=o.reportableIntervalURL(t[e].sourceIds),r.defer(d3.json,n))}(),r.awaitAll(function(t,r){if(t)return void M.log("Error requesting available data range: "+t);var a=n(r);void 0!==a.startDateMillis&&(a.sDate=new Date(a.startDateMillis)),void 0!==a.endDateMillis&&(a.eDate=new Date(a.endDateMillis)),"function"==typeof e&&e(a)})}function b(t,e){if(t&&t.availableSourcesURL&&e){var n=t.availableSourcesURL();d3.json(n,function(t,r){var a;t?e(t):r?r.success!==!0?e(r.message?r.message:"Query not successful."):(a=Array.isArray(r.data)?r.data.sort():[],a.sort(),e(null,a)):e("No data returned from "+n)})}}function C(t,e){"function"==typeof e&&(void 0===L&&(L=[]),t=t.replace(/[^0-9a-zA-Z_]/,""),L.push({name:t,func:e}))}function T(t,e){var n,r,a,o=d3.scale.ordinal().range(t),i=e.map(function(t,e){return{source:t,color:o(e)}});for(n=0,r=i.length;r>n;n+=1)a=i[n].source,""===a&&(a="Main"),isNaN(Number(a))&&(i[a]=i[n].color);return i}function D(t){var e=Number(t.source);return isNaN(e)?M.runtime.colorData[t.source]:M.runtime.colorData.reduce(function(e,n){return n.source===t.source?n.color:e},M.runtime.colorData[0].color)}function k(){var t=0,e=function(){return t};return e.incrementAndGet=function(){return t+=1},e}function I(){if(arguments.length){var t,e,n=0,r=arguments[n];for(n=1;n<arguments.length;n+=1)t=new RegExp("\\{"+(n-1)+"\\}","gi"),e=arguments[n],e instanceof Date&&(e=0===e.getUTCHours()&&0===e.getMinutes()?M.dateFormat(e):M.dateTimeFormat(e)),r=r.replace(t,e);return r}}function A(t){return t*Math.PI/180}function P(t){return 180*t/Math.PI}function w(t){function e(t,e){i.length&&(i+="&"),i+=encodeURIComponent(t)+"="+encodeURIComponent(e)}var n,r,a,o,i="";if(t)for(n in t)if(t.hasOwnProperty(n))if(r=t[n],Array.isArray(r))for(a=0,o=r.length;o>a;a++)e(n,r[a]);else e(n,r);return i}var M={version:"0.9.0"};M.api={};var R=d3.time.format.utc("%Y-%m-%d %H:%M:%S.%LZ");M.api.control={},M.api.user={},M.api.node={};var U=t();M.net={},M.net.parseURLQueryTerms=e,M.util={arraysAreEqual:a,copy:n,copyAll:r,superMethod:o},M.env={debug:!1,host:"data.solarnetwork.net",tls:function(){return void 0!==U&&void 0!==U.locaion&&void 0!==U.location.protocol&&0===U.location.protocol.toLowerCase().indexOf("https")?!0:!1}(),path:"/solarquery",solarUserPath:"/solaruser",secureQuery:!1},M.setDefaultEnv=i,void 0!==U&&void 0!==U.location&&void 0!==U.location.search&&u(e(U.location.search)),M.config={debug:!1,host:"data.solarnetwork.net",tls:function(){return void 0!==U&&void 0!==U.locaion&&void 0!==U.location.protocol&&0===U.location.protocol.toLowerCase().indexOf("https")?!0:!1}(),path:"/solarquery",solarUserPath:"/solaruser",secureQuery:!1},M.api.node.registerUrlHelperFunction=s;var O;M.api.node.nodeUrlHelper=function(t,e){function n(){return"http"+(f.tls===!0?"s":"")+"://"+f.host}function r(){return n()+f.path+"/api/v1/"+(f.secureQuery===!0?"sec":"pub")}function a(t){var e=r()+"/range/interval?nodeId="+d;return Array.isArray(t)&&(e+="&"+t.map(function(t){return"sourceIds="+encodeURIComponent(t)}).join("&")),e}function o(t,e){var n=r()+"/range/sources?nodeId="+d;return void 0!==t&&(n+="&start="+encodeURIComponent(M.dateFormat(t))),void 0!==e&&(n+="&end="+encodeURIComponent(M.dateFormat(e))),n}function i(t,e,n,a,o){var i=r()+"/datum/list?nodeId="+d;return t&&(i+="&startDate="+encodeURIComponent(M.dateTimeFormatURL(t))),e&&(i+="&endDate="+encodeURIComponent(M.dateTimeFormatURL(e))),n&&(i+="&aggregate="+encodeURIComponent(n)),Array.isArray(a)&&a.length>0&&(i+="&"+a.map(function(t){return"sourceIds="+encodeURIComponent(t)}).join("&")),void 0!==o&&(o.max>0&&(i+="&max="+encodeURIComponent(o.max)),o.offset>0&&(i+="&offset="+encodeURIComponent(o.offset))),i}function u(t){var e=r()+"/datum/mostRecent?nodeId="+d;return Array.isArray(t)&&(e+="&"+t.map(function(t){return"sourceIds="+encodeURIComponent(t)}).join("&")),e}function s(t){return arguments.length?(d=t,c):d}function l(){return"node "+d}var c={version:"1.1.0"},d=t,f=M.util.copy(e,{host:"data.solarnetwork.net",tls:!0,path:"/solarquery",secureQuery:!1});return Object.defineProperties(c,{secureQuery:{get:function(){return f.secureQuery===!0},enumerable:!0},keyDescription:{value:l},nodeId:{get:function(){return d},enumerable:!0},nodeID:{value:s},hostURL:{value:n},baseURL:{value:r},reportableIntervalURL:{value:a},availableSourcesURL:{value:o},dateTimeListURL:{value:i},mostRecentURL:{value:u}}),function(){Array.isArray(O)&&O.forEach(function(t){c.hasOwnProperty(t.name)===!1&&Object.defineProperty(c,t.name,{value:function(){return t.func.apply(c,arguments)}})})}(),c},M.api.user.registerUrlHelperFunction=c;var N;M.api.user.userUrlHelper=function(t){function e(){return"http"+(i.tls===!0?"s":"")+"://"+i.host}function n(){return e()+i.path+"/api/v1/"+(i.secureQuery===!0?"sec":"pub")}function r(){return"user"}function a(){var t=n()+"/nodes";return t}var o={version:"1.0.0"},i=M.util.copy(t,{host:"data.solarnetwork.net",tls:!0,path:"/solaruser",secureQuery:!0});return Object.defineProperties(o,{keyDescription:{value:r},hostURL:{value:e},baseURL:{value:n},viewNodesURL:{value:a}}),function(){Array.isArray(N)&&N.forEach(function(t){o.hasOwnProperty(t.name)===!1&&Object.defineProperty(o,t.name,{value:function(){return t.func.apply(o,arguments)}})})}(),o},s("viewInstruction",d),s("viewActiveInstructionsURL",f),s("viewPendingInstructionsURL",p),s("updateInstructionStateURL",m),s("queueInstructionURL",v),M.api.control.toggler=function(t){function e(t){if(void 0!==p)try{p.call(m,t)}catch(e){M.log("Error in callback: {0}",e)}}function n(t){if(Array.isArray(t)&&0!==t.length){var e=t.reduce(function(t,e){return"SetControlParameter"===e.topic&&Array.isArray(e.parameters)&&e.parameters.length>0&&e.parameters[0].name===h&&(void 0===t||t.created<e.created)?e:t},void 0);return void 0!==e&&M.log("Active instruction for {3} found in state {0} (set control {1} to {2})",e.state,h,e.parameters[0].value,y.keyDescription()),e}}function r(){return void 0===d?void 0:d.state}function a(){return void 0===d?void 0:Number(d.parameters[0].value)}function o(){return["Queued","Received","Executing"].indexOf(r())<0?v:g}function i(t){if(!arguments.length)return void 0===c?void 0:c.val;var n=queue(),i=void 0===c?void 0:c.val,u=r(),s=a();return"Queued"===u&&s!==t&&(M.log("Canceling {2} pending control {0} switch to {1}",h,s,y.keyDescription()),n.defer(M.sec.json,y.updateInstructionStateURL(d.id,"Declined"),"POST"),d=void 0,u=void 0,s=void 0),i!==t&&s!==t&&(M.log("Request {2} to change control {0} to {1}",h,t,y.keyDescription()),n.defer(M.sec.json,y.queueInstructionURL("SetControlParameter",[{name:h,value:String(t)}]),"POST")),n.awaitAll(function(t,n){if(t)return M.log("Error updating {2} control toggler {0}: {1}",h,t.status,y.keyDescription()),void e(t);if(!(n.length<1)){var r=n[0];null==r.data&&r.success===!0&&(d=void 0);var a=n[n.length-1].data;null!=a&&(d=a),e(),l&&(m.stop(),m.start(o()))}}),m}function u(t,e){var n,r;return e&&"Declined"!==e.status?t?(n=R.parse(t.created),r=R.parse(e.created),n.getTime()>r.getTime()?t.val:Number(e.parameters[0].value)):Number(e.parameters[0].value):t?t.val:void 0}function s(){var t=queue();return t.defer(y.secureQuery?M.sec.json:d3.json,y.mostRecentURL([h])),M.sec.hasTokenCredentials()===!0&&(t.defer(M.sec.json,y.viewPendingInstructionsURL(),"GET"),d&&["Completed","Declined"].indexOf(r())<0&&t.defer(M.sec.json,y.viewInstruction(d.id))),t.await(function(t,r,a,p){if(t)M.log("Error querying control toggler {0} for {2} status: {1}",h,t.status,y.keyDescription()),e(t);else{var m,v,g=void 0;if(r.data&&Array.isArray(r.data.results))for(m=0,v=r.data.results.length;v>m&&void 0===g;m++)r.data.results[m].sourceId===h&&(g=r.data.results[m]);var x=p?p.data:void 0,b=a?n(a.data):void 0,C=u(g,x?x:b?b:d),T=i();(C!==T||f!==M.sec.hasTokenCredentials())&&(M.log("Control {0} for {1} value is currently {2}",h,y.keyDescription(),void 0!==C?C:"N/A"),c=g,c&&!b&&(c.val=C),d=x?x:b,f=M.sec.hasTokenCredentials(),e())}void 0!==l&&(l=setTimeout(s,o()))}),m}var l,c,d,f,p,m={version:"1.3.0"},v=2e4,g=5e3,h="/power/switch/1",y=t;return m.start=function(t){return void 0===l&&(l=setTimeout(s,t||20)),m},m.stop=function(){return void 0!==l&&(clearTimeout(l),l=void 0),m},m.controlID=function(t){return arguments.length?(h=t,m):h},m.refreshMs=function(t){return arguments.length?("number"==typeof t&&(v=t),m):v},m.pendingRefreshMs=function(t){return arguments.length?("number"==typeof t&&(g=t),m):g},m.nodeUrlHelper=function(t){return arguments.length?(y=t,m):y},m.callback=function(t){return arguments.length?("function"==typeof t&&(p=t),m):p},Object.defineProperties(m,{pendingInstructionState:{value:r},pendingInstructionValue:{value:a},lastKnownInstructionState:{value:r},lastKnownInstructionValue:{value:a},value:{value:i}}),m},M.api.datum={},M.format={},M.format.dateTimeFormat=d3.time.format.utc("%Y-%m-%d %H:%M"),M.format.timestampFormat=d3.time.format.utc("%Y-%m-%d %H:%M:%S.%LZ"),M.format.dateTimeFormatLocal=d3.time.format("%Y-%m-%d %H:%M"),M.format.dateTimeFormatURL=d3.time.format.utc("%Y-%m-%dT%H:%M"),M.format.dateFormat=d3.time.format.utc("%Y-%m-%d"),M.api.datum.datumDate=g,M.log=h,M.api.datum.loader=function(t,e,n,r,a){function o(t){d=2,u&&u.call(c,t,l)}function i(u){var c,d,f,p={};u&&(p.offset=u),c=e.dateTimeListURL(n,r,a,t,p),s&&!function(){var t=w(s);t.length&&(c+="&"+t)}(),d=function(t){return t.success===!0&&void 0!==t.data&&Array.isArray(t.data.results)===!0?t.data.results:void 0},f=function(t){return t.data.returnedResultCount+t.data.startingOffset<t.data.totalResults?t.data.returnedResultCount+t.data.startingOffset:0},d3.json(c,function(t,n){var r,a;return t?void M.log("Error requesting data for {0}: {2}",e.keyDescription(),t):(r=d(n),void 0===r?(M.log("No data available for {0}",e.keyDescription()),void o(t)):(l=void 0===l?r:l.concat(r),a=f(n),void(a>0?i(a):o(t))))})}var u,s,l,c={version:"1.0.0"},d=0;return c.callback=function(t){return arguments.length?("function"==typeof t&&(u=t),c):u},c.urlParameters=function(t){return arguments.length?("object"==typeof t&&(s=t),c):s},c.load=function(t){return"function"==typeof t&&(u=t),d=1,i(),c},c},M.api.datum.loaderQueryRange=y,M.api.datum.multiLoader=function(t){var e,n={version:"1.0.0"},r=queue();return n.callback=function(t){return arguments.length?("function"==typeof t&&(e=t),n):e},n.load=function(){return t.forEach(function(t){r.defer(t.load)}),r.awaitAll(function(t,r){e&&e.call(n,t,r)}),n},n},M.api.datum.sumCounter=function(t){function e(t){var e=0;return t.forEach(function(t){var n=Number(t[c]);isNaN(n)&&(n=0),e+=n}),e}function n(n){M.datum.loader(l,t,null,null,"RunningTotal").callback(function(t,r){var a=t?0:e(r);f=a,n()}).load()}function r(){function t(){i&&i.call(s,f),void 0!==u&&(u=setTimeout(r,d))}n(t)}function a(){return void 0===u?(u=setTimeout(r,20),s):void 0}function o(){return void 0!==u?(clearTimeout(u),u=void 0,s):void 0}var i,u,s={version:"1.1.0"},l=["Main"],c="wattHours",d=6e4,f=0;return s.callback=function(t){return arguments.length?("function"==typeof t&&(i=t),s):i},s.sourceIds=function(t){return arguments.length?(Array.isArray(t)?l=t:"string"==typeof t&&(l=t.split(/\s*,\s*/)),s):l},Object.defineProperties(s,{start:{value:a},stop:{value:o}}),s},M.api.node.availableDataRange=x,M.api.node.availableSources=b,M.api.loc={},M.api.loc.registerUrlHelperFunction=C;var L;M.api.loc.locationUrlHelper=function(t,e){function n(){return"http"+(f.tls===!0?"s":"")+"://"+f.host}function r(){return n()+f.path+"/api/v1/"+(f.secureQuery===!0?"sec":"pub")}function a(t){var e=r()+"/location/datum/interval?locationId="+d;return Array.isArray(t)&&(e+="&"+t.map(function(t){return"sourceIds="+encodeURIComponent(t)}).join("&")),e}function o(t,e){var n=r()+"/location/datum/sources?locationId="+d;return void 0!==t&&(n+="&start="+encodeURIComponent(M.dateFormat(t))),void 0!==e&&(n+="&end="+encodeURIComponent(M.dateFormat(e))),n}function i(t,e,n,a,o){var i=r()+"/location/datum/list?locationId="+d;return t&&(i+="&startDate="+encodeURIComponent(M.dateTimeFormatURL(t))),e&&(i+="&endDate="+encodeURIComponent(M.dateTimeFormatURL(e))),n&&(i+="&aggregate="+encodeURIComponent(n)),Array.isArray(a)&&(i+="&"+a.map(function(t){return"sourceIds="+encodeURIComponent(t)}).join("&")),void 0!==o&&(o.max>0&&(i+="&max="+encodeURIComponent(o.max)),o.offset>0&&(i+="&offset="+encodeURIComponent(o.offset))),i}function u(t){var e=r()+"/location/datum/mostRecent?locationId="+d;return Array.isArray(t)&&(e+="&"+t.map(function(t){return"sourceIds="+encodeURIComponent(t)}).join("&")),e}function s(t){return arguments.length?(d=t,c):d}function l(){return"node "+nodeId}var c={version:"1.0.0"},d=t,f=M.util.copy(e,{host:"data.solarnetwork.net",tls:!0,path:"/solarquery",secureQuery:!1});return Object.defineProperties(c,{keyDescription:{value:l},locationId:{get:function(){return d},enumerable:!0},locationID:{value:s},hostURL:{value:n},baseURL:{value:r},reportableIntervalURL:{value:a},availableSourcesURL:{value:o},dateTimeListURL:{value:i},mostRecentURL:{value:u}}),function(){Array.isArray(L)&&L.forEach(function(t){c.hasOwnProperty(t.name)===!1&&Object.defineProperty(c,t.name,{value:function(){return t.func.apply(c,arguments)}})})}(),c},M.chart={},M.Configuration=function(t){if(this.map={},void 0!==t){var e=this;!function(){var n,r=function(t){return function(){return e.map[t]}},a=function(t){return function(n){e.map[t]=n}};for(n in t)t.hasOwnProperty(n)&&!e.hasOwnProperty(n)&&Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:r(n),set:a(n)}),e.map[n]=t[n]}()}},M.Configuration.prototype={enabled:function(t){return void 0===t?!1:void 0!==this.map[t]},toggle:function(t,e){var n=e;return void 0===t?this:(void 0===n&&(n=void 0===this.map[t]),this.value(t,n===!0?!0:null))},value:function(t,e){var n=this;return 1===arguments.length?this.map[t]:(null===e?(delete this.map[t],this.hasOwnProperty(t)&&delete this[t]):(this.map[t]=e,this.hasOwnProperty(t)||Object.defineProperty(this,t,{enumerable:!0,configurable:!0,get:function(){return n.map[t]},set:function(e){n.map[t]=e}})),this)}},M.chart.baseTimeChart=function(t,e){function n(t,e,n){var r=M.tapEventNames[t];r&&(e.on(r)||e.on(r,n),$[r]+=1)}function r(t,e,n){var r=M.tapEventNames[t];r&&($[r]-=1,$[r]<1&&e.on(r,null))}function a(){var t=d3.event,e=(new Date).getTime(),n=e-tt.time,r=this;tt.time=e,"dblclick"===t.type||M.hasTouchSupport&&500>n?(tt.timer&&(clearTimeout(tt.timer),delete tt.timer),ct.call(r)):M.hasTouchSupport?(tt.timer=setTimeout(function(){var e=d3.event;try{d3.event=t,lt.call(r)}finally{d3.event=e}},500),t.preventDefault()):lt.call(r)}function o(){L.aggregate(H.aggregate),L.plotProperties(H.value("plotProperties")),D=H.value("transitionMs")||600,k=H.value("ruleOpacity")||.1,I=H.value("vertRuleOpacity")||.05}function i(){var t,e=d3.max(G.domain(),function(t){return Math.abs(t)});et=1,_?et=_.call(F,e):e>=1e9?et=1e9:e>=1e6?et=1e6:e>=1e3&&(et=1e3),t=1===et?",d":",g",nt=d3.format(t)}function u(t){return nt(t/et)}function s(){return T[C]}function l(){return T[C]+"Reverse"}function c(){i()}function d(t){return"translate(0,"+(Math.round(G(t)+.5)-.5)+")"}function f(t){return 0===t?"origin":"m"}function p(t){return 0===t?"origin":null}function m(t){return C.indexOf("Minute")>=0&&0===t.getUTCHours()||"Hour"===C&&0===t.getUTCHours()||"Day"===C&&1===t.getUTCDate()||"Month"===C&&0===t.getUTCMonth()}function v(){return K.ticks(rt)}function g(){var t=K.tickFormat(rt);return function(e,n){return W?W.call(F,e,n,K,t):t(e,n)}}function h(){d3.event&&d3.event.transform&&d3.event.transform(K);var t=v(),e=g(),n=P.selectAll("text").data(t).classed({major:m});n.transition().duration(D).attr("x",K).text(e),n.enter().append("text").attr("dy","-0.5em").style("opacity",1e-6).attr("x",K).classed({major:m}).transition().duration(D).style("opacity",1).text(e).each("end",function(){d3.select(this).style("opacity",null)}),n.exit().transition().duration(D).style("opacity",1e-6).remove()}function y(){return G.ticks(at)}function x(){var t=y(),e=A.select("g.rule").selectAll("g").data(t,Object),n=e.transition().duration(D);n.attr("transform",d).select("text").text(u).attr("class",p),n.select("line").attr("class",f),e.exit().transition().duration(D).style("opacity",1e-6).remove();var r=e.enter().append("g").style("opacity",1e-6).attr("transform",d);r.append("line").attr("x2",z+B[3]).attr("x1",B[3]).attr("class",f),r.append("text").attr("x",B[3]-10).text(u).attr("class",p),r.transition().duration(D).style("opacity",1).each("end",function(){d3.select(this).style("opacity",null)})}function b(){return O||(O=A.append("g").attr("class","hover-root").attr("transform","translate("+B[3]+","+B[0]+")"),N=A.append("rect").attr("width",z).attr("height",X).attr("fill","none").attr("pointer-events","all").attr("class","pointer-capture").attr("transform","translate("+B[3]+","+B[0]+")")),N}var C,T,D,k,I,A,P,w,R,U,O,N,L={version:"1.0.0"},F=L,E="__internal__",S=["FiveMinute","TenMinute","FifteenMinute","Hour","HourOfDay","SeasonalHourOfDay","Day","DayOfWeek","SeasonalDayOfWeek","Month"],H=e||new M.Configuration,j=M.pixelWidth(t),B=H.padding||[10,0,20,30],z=(H.width||j||812)-B[1]-B[3],X=(H.height||300)-B[0]-B[2],K=d3.time.scale.utc().range([0,z]),G=d3.scale.linear().range([X,0]),_=void 0,Y=void 0,W=void 0,q=void 0,Q=void 0,V=void 0,Z=void 0,J=void 0,$=function(){var t={};return Object.keys(M.tapEventNames).forEach(function(e){t[M.tapEventNames[e]]=0}),t}(),tt={time:0},et=1,nt=d3.format(",d"),rt=12,at=5,ot=function(){h(),x()},it=function(){q&&q.call(F,O,M.tapCoordinates(this))},ut=function(){Q&&Q.call(F,O,M.tapCoordinates(this))},st=function(){V&&V.call(F,O,M.tapCoordinates(this))},lt=function(){clickCallback&&clickCallback.call(F,O,M.tapCoordinates(this))},ct=function(){J&&J.call(F,O,M.tapCoordinates(this))};return A=d3.select(t).select("svg"),A.empty()&&(A=d3.select(t).append("svg:svg")),A.attr("class","chart").attr("width",z+B[1]+B[3]).attr("height",X+B[0]+B[2]).selectAll("*").remove(),w=A.append("g").attr("class","data-root").attr("transform","translate("+B[3]+","+B[0]+")"),P=A.append("g").attr("class","ticks").attr("transform","translate("+B[3]+","+(X+B[0]+B[2])+")"),A.append("g").attr("class","crisp rule").attr("transform","translate(0,"+B[0]+")"),R=A.append("g").attr("class","rule").attr("transform","translate("+B[3]+","+B[0]+")"),U=A.append("g").attr("class","annot-root").attr("transform","translate("+B[3]+","+B[0]+")"),L.scaleDate=function(t){return K(t)},L.scaleValue=function(t){return G(t)},L.xDomain=function(){return K.domain()},L.yDomain=function(){return G.domain()},L.yScale=function(){return _?_():et},L.aggregate=function(t){if(!arguments.length)return C;var e=S.indexOf(t);return C=0>e?"Hour":t,F},L.aggregateNormalizedDuration=function(){return"FiveMinute"===C?3e5:"TenMinute"===C?6e5:"FifteenMinute"===C?9e5:"Hour"===C||"HourOfDay"===C||"SeasonalHourOfDay"===C?36e5:"Day"===C||"DayOfWeek"===C||"SeasonalDayOfWeek"===C?864e5:"Month"===C?2592e6:6e4},L.isNormalizedDuration=function(t,e){var n,r,a=L.aggregateNormalizedDuration();return t&&e?(n=Math.abs(e.getTime()-t.getTime()),n===a?!0:(e.getTime()<t.getTime()&&(r=t,t=e,e=r),"Month"===C?d3.time.month.utc.offset(t,1).getTime()===e.getTime():"SeasonalHourOfDay"===C?(r=t.getUTCHours()+1,r>23&&(r=0),e.getUTCHours()===r&&t.getTime()!==e.getTime()):"SeasonalDayOfWeek"===C?(r=t.getUTCDay()+1,r>6&&(r=0),e.getUTCDay()===r&&t.getTime()!==e.getTime()):!1)):!1},L.addNormalizedDuration=function(t){return t?"Month"===C?d3.time.month.utc.offset(t,1):new Date(t.getTime()+L.aggregateNormalizedDuration()):void 0},L.reset=function(){return O&&st(),F},L.regenerate=function(){return o(),L.setup(),L.draw(),Y&&Y.call(F,U),F},L.transitionMs=function(t){return arguments.length?(D=+t,F):D},L.plotProperties=function(t){if(!arguments.length)return T;var e={};return S.forEach(function(n){e[n]=void 0!==t&&void 0!==t[n]?t[n]:"watts"}),T=e,F},L.displayFactorCallback=function(t){return arguments.length?(_="function"==typeof t?t:void 0,F):_},L.drawAnnotationsCallback=function(t){return arguments.length?(Y="function"==typeof t?t:void 0,F):Y},L.hoverEnterCallback=function(t){if(!arguments.length)return q;var e=b();return"function"==typeof t?(q=t,e.on("mouseover",it)):(q=void 0,e.on("mouseover",null)),F},L.hoverMoveCallback=function(t){if(!arguments.length)return Q;var e=b();return"function"==typeof t?(b(),Q=t,e.on("mousemove",ut)):(Q=void 0,e.on("mousemove",null)),F},L.hoverLeaveCallback=function(t){if(!arguments.length)return V;var e=b();return"function"==typeof t?(V=t,e.on("mouseout",st)):(V=void 0,e.on("mouseout",null)),F},L.doubleClickCallback=function(t){if(!arguments.length)return J;var e=b();return"function"==typeof t?(J=t,n("dblclick",e,a)):(J=void 0,r("dblclick",e,a)),F},L.rangeSelectionCallback=function(t){if(!arguments.length)return Z;var e=b();return"function"==typeof t?(Z=t,n("click",e,a)):(Z=void 0,r("click",e,a)),F},L.xAxisTickCallback=function(t){return arguments.length?("function"==typeof t&&(W=t),F):W},L.ruleOpacity=function(t){return arguments.length?(k=t,F):k},L.vertRuleOpacity=function(t){return arguments.length?(I=t,F):I},Object.defineProperties(L,{me:{get:function(){return F},set:function(t){F=t}},x:{get:function(){return K},set:function(t){K=t}},y:{get:function(){return G},set:function(t){G=t}},xAxisTickCount:{get:function(){return rt},set:function(t){rt=t}},xAxisTicks:{get:function(){return v},set:function(t){v=t}},xAxisTickFormatter:{get:function(){return g},set:function(t){g=t}},yAxisTicks:{get:function(){return y},set:function(t){y=t}},yAxisTickCount:{get:function(){return at},set:function(t){at=t}},config:{value:H},internalPropName:{value:E},plotPropertyName:{get:s},plotReversePropertyName:{get:l},padding:{value:B},width:{value:z,enumerable:!0},height:{value:X,enumerable:!0},svgRoot:{value:A},svgDataRoot:{value:w},svgRuleRoot:{value:R},svgTickGroupX:{value:P},svgHoverRoot:{get:function(){return O}},handleHoverEnter:{get:function(){return it},set:function(t){it=t}},handleHoverMove:{get:function(){return ut},set:function(t){ut=t}},handleHoverLeave:{get:function(){return st},set:function(t){st=t}},handleClick:{get:function(){return lt},set:function(t){lt=t}},handleDoubleClick:{get:function(){return ct},set:function(t){ct=t}},computeUnitsY:{value:i},drawAxisX:{get:function(){return h},set:function(t){h=t}},drawAxisY:{get:function(){return x},set:function(t){x=t}},parseConfiguration:{get:function(){return o},set:function(t){o=t}},draw:{get:function(){return ot},set:function(t){ot=t}},setup:{get:function(){return c},set:function(t){c=t}}}),o(),L},M.chart.baseGroupedTimeChart=function(t,e){function n(t,e,n){return void 0===d?"black":d(t,e.sourceId,n)}function a(t){var e,n,r,a,o=u.plotPropertyName,i=u.plotReversePropertyName;for(n=0;n<t.length;n+=1)for(r=t[n].values,e=0;e<r.length-1;e+=1)u.isNormalizedDuration(r[e].date,r[e+1].date)!==!0&&(a=M.util.copy(r[e]),a.date=u.addNormalizedDuration(a.date),a[o]=null,a[i]=null,r.splice(e+1,0,a))}var o=M.chart.baseTimeChart(t,e),i=o.reset,u=r(o);u.me=u;var s={},l={},c=void 0,d=void 0,f=void 0,p=void 0,m=[],v={};return u.reset=function(){return i(),s={},m=[],v={},u.me},u.load=function(t,e){return void 0===s[e]?(m.push(e),s[e]=t):s[e]=s[e].concat(t),u.me},u.data=function(t){return s[t]},u.stash=function(t,e,n){return void 0===v[e]||n===!0?v[e]=t:v[e]=v[e].concat(t),u.me},u.stashedData=function(t){return v[t]},u.scaleFactor=function(t,e){var n;if(!arguments.length)return l;if(1===arguments.length){if("string"==typeof t)return n=l[t],void 0===n?1:n;l=t}else 2==arguments.length&&(l[t]=e);return u.me},u.dataCallback=function(t){return arguments.length?(c="function"==typeof t?t:void 0,u.me):c},u.colorCallback=function(t){return arguments.length?(d="function"==typeof t?t:void 0,u.me):d},u.sourceExcludeCallback=function(t){return arguments.length?(f="function"==typeof t?t:void 0,u.me):f},u.layerPostProcessCallback=function(t){return arguments.length?(p="function"==typeof t?t:void 0,u.me):p},Object.defineProperties(u,{fillColor:{value:n},insertNormalizedDurationIntoLayerData:{value:a},groupIds:{get:function(){return m}}}),u},M.chart.baseGroupedSeasonalLineChart=function(t,e){function n(t,e){var n=f.config.seasonColors||M.seasonColors,r=(e+(g?0:2))%4;return n[r]}function r(t){return new Date(Date.UTC(2001,0,1)+t)}function a(t){t.getTime()}function o(){return d3.time.day.utc}function i(t){var e,n,a,o,i,u,s=null,l=null,c=null,d=t.length,p=!1;for(a=0;d>a;a+=1)e=t[a],o=e[f.internalPropName].groupId,f.sourceExcludeCallback()&&f.sourceExcludeCallback().call(f.me,o,e.sourceId)||(n=e[f.plotPropertyName],void 0!==n&&(p=y[o]===!0,p?c+=n:l+=n),e.date&&((void 0===i||e.date.getTime()<i.getTime())&&(i=e.date),(void 0===u||e.date.getTime()>u.getTime())&&(u=e.date)));return(null!==l||null!==c)&&(s=l-c),{date:r(t[0].timeKey),y:s,plus:l,minus:c,season:t[0].season,timeKey:t[0].timeKey,groupId:t[0][f.internalPropName].groupId}}function u(){var t=f.groupIds,e=[null,null],n=[0,0],r=o(),u=d3.format("02g");h={},t.forEach(function(t){var r,o,s,l=f.data(t);!l||!l.length>1||(r=d3.nest().key(function(e){return e.hasOwnProperty(f.internalPropName)||(e[f.internalPropName]={groupId:t},f.dataCallback()?f.dataCallback().call(f.me,t,e):void 0===e.date&&(e.date=M.datum.datumDate(e)),e.season=M.seasonForDate(e.date),e.timeKey=a(e.date)),e.season}).key(function(t){return u(t.timeKey)}).sortKeys(d3.ascending).rollup(i).entries(l),r.length<1||(f.layerPostProcessCallback()&&(r=f.layerPostProcessCallback().call(f.me,t,r)),h[t]=r,o=r.reduce(function(t,e){return t.concat(e.values.map(function(t){return t.values}))},[]),s=d3.extent(o,function(t){return t.y}),s[0]<n[0]&&(n[0]=s[0]),s[1]>n[1]&&(n[1]=s[1]),s=d3.extent(o,function(t){return t.date.getTime()}),(null===e[0]||s[0]<e[0].getTime())&&(e[0]=new Date(s[0])),(null===e[1]||s[1]>e[1].getTime())&&(e[1]=new Date(s[1]))))}),f.x.domain(r.range(e[0],r.offset(e[1],1))),f.y.domain(n).nice(),f.computeUnitsY()}function s(t){return Math.round(f.x(t)+.5)-.5}function l(){var t=f.transitionMs(),e=f.svgRuleRoot.selectAll("line.vert").data(f.x.domain());e.transition().duration(t).attr("x1",s).attr("x2",s),e.enter().append("line").style("opacity",1e-6).classed("vert",!0).attr("x1",s).attr("x2",s).attr("y1",0).attr("y2",f.height).transition().duration(t).style("opacity",f.vertRuleOpacity()).each("end",function(){d3.select(this).style("opacity",null)}),e.exit().transition().duration(t).style("opacity",1e-6).remove()}function c(){var t=[[],[],[],[]],e=f.groupIds;return e.forEach(function(e){var n=h[e];n&&n.forEach(function(e){var n=Number(e.key);t[n].push(e.values.map(function(t){return t.values}))})}),{groupedData:t}}function d(){var t,e,r,a=f.transitionMs();r=c(),t=f.svgDataRoot.selectAll("g.season").data(r.groupedData),t.enter().append("g").attr("class","season").style("stroke",n),e=t.selectAll("path.line").data(Object,function(t){return t[0].groupId}),e.transition().duration(a).attr("d",x),e.enter().append("path").classed("line",!0).attr("d",x),e.exit().transition().duration(a).style("opacity",1e-6).remove(),p(),l()}var f=M.chart.baseGroupedTimeChart(t,e),p=M.util.superMethod.call(f,"draw"),m=M.util.copyAll(f,{version:"1.0.0"});m.me=m;var v=["Midnight","1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","Noon","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"];f.x=d3.scale.ordinal().rangePoints([0,f.width],.2),f.xAxisTicks=function(){return f.x.domain()},f.xAxisTickFormatter=function(){return function(t,e){return f.xAxisTickCallback()?xAxisTickCallback().call(f.me,t,e,f.x):v[f.x.domain().indexOf(t)]}};var g,h,y={Consumption:!0},x=d3.svg.line().interpolate("monotone").x(function(t){return Math.round(f.x(t.date)+.5)-.5}).y(function(t){return Math.round(f.y(t.y)+.5)-.5});return m.northernHemisphere=function(t){if(!arguments.length)return g;if(t!==g)return g=t===!0,f.svgDataRoot.selectAll("g.season").transition().duration(f.transitionMs()).style("stroke",n),f.me},m.negativeGroupIds=function(t){return arguments.length?(y={},
t.forEach(function(t){y[t]=!0}),f.me):function(){var t,e=[];for(t in y)y.hasOwnProperty(t)&&e.pus(t);return e}()},m.timeKeyLabels=function(t){return arguments.length?(Array.isArray(t)&&(v=t),f.me):v},Object.defineProperties(m,{dateForTimeKey:{get:function(){return r},set:function(t){r=t}},timeKeyForDate:{get:function(){return a},set:function(t){a=t}},timeKeyInterval:{get:function(){return o},set:function(t){o=t}}}),f.setup=u,f.draw=d,m},M.chart.baseGroupedStackTimeChart=function(t,e){function n(){c(),m=f.config.value("wiggle")===!0?"wiggle":"zero",v=f.config.value("reverseValueSupport")===!0?!0:!1}function a(t,e){var n=f.config.value("opacityReduction")||.1;return 1-e*n}function o(t){var e,n=f.plotReversePropertyName;return e="zero"!==m?d3.layout.stack().offset(m).offset():function(e){var r,a,o,i,u,s=e[0].length,l=e.length,c=[];for(r=0;s>r;r+=1){for(o=0,a=0;l>a;a+=1)i=e[a][r][1],u=v?t[a].values[r][n]:0,0>i?(o+=i,e[a][r][1]=-i):u&&(o-=u);c[r]=o}return c}}function i(){var t,e,n,r,a=f.plotPropertyName,i=f.plotReversePropertyName,u=d3.layout.stack().values(function(t){return t.values}).x(function(t){return t.date}).y(function(t){var e=t[a],n=0,r=s.scaleFactor(t[s.internalPropName].groupId);return void 0===e||null===e||"zero"!==m&&0>e?e=0:v&&"zero"===m&&void 0!==t[i]&&(n=t[i]),(e+n)*r});g={},f.groupIds.forEach(function(i){var l,c,d=f.data(i);if(d&&!(!d.length>1)&&(c=d3.nest().key(function(t){return t.hasOwnProperty(f.internalPropName)||(t[f.internalPropName]={groupId:i},f.dataCallback()?f.dataCallback().call(f.me,i,t):void 0===t.date&&(t.date=M.datum.datumDate(t))),f.sourceExcludeCallback()&&f.sourceExcludeCallback().call(f.me,i,t.sourceId)?p:t.sourceId}).sortKeys(d3.ascending).entries(d),c=c.filter(function(t){return t.key!==p}),!(c.length<1))){l={},l[a]=null,l[f.internalPropName]={groupId:i},M.nestedStackDataNormalizeByDate(c,l),h===!0&&s.insertNormalizedDurationIntoLayerData(c),f.layerPostProcessCallback()&&(c=f.layerPostProcessCallback().call(f.me,i,c));var m=[d[0].date,d[d.length-1].date];(void 0===t||m[0].getTime()<t.getTime())&&(t=m[0]),(void 0===e||m[1].getTime()>e.getTime())&&(e=m[1]),u.offset(o(c));var v=u(c);g[i]=v;var y=[d3.min(v[0].values,function(t){return t.y0}),d3.max(v[v.length-1].values,function(t){return t.y0+t.y})];(void 0===n||y[0]<n)&&(n=y[0]),(void 0===r||y[1]>r)&&(r=y[1])}}),void 0!==t&&void 0!==e&&f.x.domain([t,e]),void 0!==n&&void 0!==r&&f.y.domain([n,r]).nice(),f.computeUnitsY()}function u(){return f.wiggle()===!0?[]:d()}var s=M.chart.baseGroupedTimeChart(t,e),l=s.reset,c=s.parseConfiguration,d=s.yAxisTicks,f=r(s);f.me=f;var p="__discard__",m=void 0,v=!0,g={},h=!1;return f.reset=function(){return l(),g={},f.me},f.stackOffset=function(t){return arguments.length?(m=t,f.me):m},f.wiggle=function(t){return arguments.length?f.stackOffset(t===!0?"wiggle":"zero"):"wiggle"===m},f.normalizeDataTimeGaps=function(t){return arguments.length?(h=t===!0,f.me):h},f.enumerateDataOverTime=function(t){if("function"!=typeof t)return f.me;var e,n=f.groupIds,r={},a=f.xDomain()[0];if(!n||n.length<1)return f.me;for(;;)if(e={date:a,data:{}},n.forEach(function(t){var n=g[t];void 0===r[t]&&(r[t]={index:0}),!n||n.length<1||n[0].values.length<=r[t].index||(void 0===r[t].date&&(r[t].date=n[0].values[0].date),n[0].values[r[t].index].date.getTime()===a.getTime()&&(n.forEach(function(n){e.data[n.key]=n.values[r[t].index]}),r[t].index+=1,r[t].date=r[t].index<n[0].values.length?n[0].values[r[t].index].date:null))}),t.call(f.me,e.data,a),a=r[n.reduce(function(t,e){var n=r[t].date,a=r[e].date;return n?a?a>n?t:e:t:e})].date,!a)break;return f.me},Object.defineProperties(f,{negativeOffsetFromReversePlotProperty:{get:function(){return v},set:function(t){v=t}},groupOpacityFn:{value:a},discardId:{value:p},groupLayers:{get:function(){return g}}}),n(),f.parseConfiguration=n,f.setup=i,f.yAxisTicks=u,f},M.chart.baseGroupedStackTimeBarChart=function(t,e){function n(t,e){return k.fillColor.call(this,t[0][k.internalPropName].groupId,t[0],e)}function a(){return k.config.vertRuleOpacity||.05}function o(){var t,e=k.x,n=k.aggregate(),r=e.domain(),a=1,o=r[1];"Month"===n?(o=d3.time.month.utc.offset(o,1),t=d3.time.months.utc):"Day"===n?(o=d3.time.day.utc.offset(o,1),t=d3.time.days.utc):"FiveMinute"===n?(a=5,o=d3.time.minute.utc.offset(o,a),t=d3.time.minutes.utc):"TenMinute"===n?(a=10,o=d3.time.minute.utc.offset(o,a),t=d3.time.minutes.utc):"FifteenMinute"===n?(a=15,o=d3.time.minute.utc.offset(o,a),t=d3.time.minutes.utc):(o=d3.time.hour.utc.offset(o,1),t=d3.time.hours.utc),t=t(r[0],o,a),A.domain(t).rangeRoundBands(e.range(),.2)}function i(t){return t.date}function u(t){return A(t.date)}function s(t){return f(t.date)}function l(t){return Math.floor(u(t)-g()/2)+.5}function c(t){return k.y(t.y0+t.y)}function d(t){return k.y(t.y0)-k.y(t.y0+t.y)}function f(t){return A(t)+A.rangeBand()/2}function p(t){var e=k.aggregate();return"Day"===e&&1===t.getUTCDate()||"Hour"===e&&0===t.getUTCHours()||"Month"===e&&0===t.getUTCMonth()}function m(){var t=k.config.value("tickCountX");return t||(k.width>600?12:5)}function v(){var t=A.domain();return t.length<7?t:k.x.ticks(m())}function g(){var t=A.domain(),e=t.length>1?A(t[1])-A(t[0]):A.rangeBand(),n=e-A.rangeBand();return n}function h(t){for(var e=0,n=t.length,r=k.x.domain()[0];n>e&&!(t[e].date.getTime()>=r.getTime());)e+=1;return 0===e?t:t.slice(e)}function y(){var t=k.x.tickFormat(m()),e=k.xAxisTickCallback();return function(n,r){return e?e.call(k.me,n,r,k.x,t):t(n,r)}}function x(){var t,e=v(),n=k.transitionMs(),r=y();e=e.filter(function(t){return void 0!==A(t)}),t=k.svgTickGroupX.selectAll("text").data(e,Object).classed({major:p}),t.transition().duration(n).attr("x",f).text(r),t.enter().append("text").attr("dy","-0.5em").style("opacity",1e-6).attr("x",f).classed({major:p}).transition().duration(n).style("opacity",1).text(r).each("end",function(){d3.select(this).style("opacity",null)}),t.exit().transition().duration(n).style("opacity",1e-6).remove()}function b(t){var e=k.y(0),n=k.transitionMs(),r=t.selectAll("rect").data(Object,i);r.transition().duration(n).attr("x",u).attr("y",c).attr("height",d).attr("width",A.rangeBand()),r.enter().append("rect").attr("x",u).attr("y",e).attr("height",1e-6).attr("width",A.rangeBand()).transition().duration(n).attr("y",c).attr("height",d),r.exit().transition().duration(n).style("opacity",1e-6).remove()}function C(t){var e,n,r=k.transitionMs();n=h(t),e=P.selectAll("line").data(n,i),e.transition().duration(r).attr("x1",l).attr("x2",l),e.enter().append("line").style("opacity",1e-6).attr("x1",l).attr("x2",l).attr("y1",0).attr("y2",k.height+10).transition().duration(r).style("opacity",a()).each("end",function(){d3.select(this).style("opacity",null)}),e.exit().transition().duration(r).style("opacity",1e-6).remove()}function T(t){var e=k.svgHoverRoot.selectAll("rect.highlightbar").data(t);e.attr("x",u).attr("width",A.rangeBand()),e.enter().append("rect").attr("x",u).attr("y",0).attr("height",k.height).attr("width",A.rangeBand()).classed("highlightbar clickable",!0),e.exit().remove()}function D(t){var e=t&&t.length>0?t.slice(0,1):[],n=t&&t.length>0?u(t[0]):0,r=t&&t.length>0?u(t[t.length-1]):0,a=r-n+A.rangeBand(),o=k.svgHoverRoot.selectAll("rect.selectionbar").data(e);o.attr("x",n).attr("width",a),o.enter().append("rect").attr("x",n).attr("y",0).attr("height",k.height).attr("width",a).classed("selectionbar clickable",!0),o.exit().remove()}var k=M.chart.baseGroupedStackTimeChart(t,e),I=r(k);I.me=I;var A=d3.scale.ordinal(),P=k.svgRoot.insert("g",".annot-root").attr("class","vertrule").attr("transform","translate("+k.padding[3]+","+k.padding[0]+")");return I.scaleDate=function(t){var e=A.range(),n=A.rangeExtent(),r=k.scaleDate(t),a=e[Math.round(r/n[1]*(e.length-1))]+A.rangeBand()/2;return a},Object.defineProperties(I,{svgVertRuleGroup:{value:P},xBar:{value:A},xBarPadding:{value:g},trimToXDomain:{value:h},computeDomainX:{value:o},groupFillFn:{value:n},keyX:{value:i},valueX:{value:u},valueXMidBar:{value:s},valueXVertRule:{value:l},valueY:{value:c},heightY:{value:d},drawAxisXRules:{value:C},drawBarsForSources:{value:b},drawHoverHighlightBars:{value:T},drawSelection:{value:D}}),k.drawAxisX=x,I},M.chart.basicLineChart=function(t,e){function n(){var t=s.plotPropertyName,e=[null,null],n=[null,null];v=[],p.forEach(function(r){var a=c.data(r);a&&a.forEach(function(a){var o;void 0===a.date&&(a.date=M.datum.datumDate(a)),d&&d.call(this,r)||((null===e[0]||a.date<e[0])&&(e[0]=a.date),(null===e[1]||a.date>e[1])&&(e[1]=a.date),o=a[m[r]?m[r]:t],void 0!==o&&((null===n[0]||o<n[0])&&(n[0]=o),(null===n[1]||o>n[1])&&(n[1]=o)))}),v.push(a)}),h.domain(p.length).range(colorbrewer.Set3[p.length<3?3:p.length>11?12:p.length]),s.x.domain(e),s.y.domain(n).nice(),s.computeUnitsY()}function r(t,e){return p[e]}function a(t,e){return h(e)}function o(t,e){var n=d?d.call(this,p[e]):!1;return n?1e-6:1}function i(t){t.style("opacity",o).attr("stroke",a).attr("d",g)}function u(){var t,e=s.transitionMs();t=s.svgDataRoot.selectAll("path").data(v,function(t,e){return p[e]}),t.attr("class",r).transition().duration(e).call(i),t.enter().append("path").attr("class",r).call(i),t.exit().transition().duration(e).style("opacity",1e-6).remove(),l()}var s=M.chart.baseTimeChart(t,e),l=M.util.superMethod.call(s,"draw"),c=function(){var t=M.util.copy(s);return Object.defineProperty(t,"version",{value:"1.0.0",enumerable:!0,configurable:!0}),t}();s.me=c;var d,f={},p=[],m={},v=[],g=d3.svg.line().interpolate("monotone").x(function(t){return Math.round(s.x(t.date)+.5)-.5}).y(function(t){var e=this.getAttribute("class"),n=m[e]?m[e]:s.plotPropertyName,r=t[n];return Math.round(s.y(void 0===r?null:r)+.5)-.5}),h=d3.scale.ordinal().range(colorbrewer.Set3[12]);return c.load=function(t,e,n){return void 0===f[e]?(p.push(e),f[e]=t):f[e]=f[e].concat(t),n?m[e]=n:m[e]&&delete m[e],c},c.sourceExcludeCallback=function(t){return arguments.length?(d="function"==typeof t?t:void 0,c):d},c.colors=function(t){return arguments.length?(h.range(t),c):h.range()},c.colorScale=function(){return h},c.data=function(t){return f[t]},c.reset=function(){return s.reset(),f={},p.length=0,m={},v.length=0,c},s.setup=n,s.draw=u,c},M.chart.energyBarOverlapChart=function(t,e){function n(t,e){return a.groupOpacityFn(null,e)}function r(){var t,e,r=[],o=a.groupIds,i=a.transitionMs();a.computeDomainX(),o.forEach(function(t){var e=a.groupLayers[t];void 0===e?r.push([]):r.push(e.map(function(t){return t.values}))}),t=u.selectAll("g.dataType").data(r,function(t,e){return o[e]}),t.enter().append("g").attr("class","dataType").style("opacity",n),e=t.selectAll("g.source").data(Object,function(t){return t[0].sourceId}).style("fill",a.groupFillFn),e.enter().append("g").attr("class","source").style("fill",a.groupFillFn),e.exit().transition().duration(i).style("opacity",1e-6).remove(),a.drawBarsForSources(e),a.drawAxisY(),a.drawAxisX()}var a=M.chart.baseGroupedStackTimeBarChart(t,e),o=function(){var t=M.util.copy(a);return Object.defineProperty(t,"version",{value:"1.0.0",enumerable:!0,configurable:!0}),t}();a.me=o;var i=o,u=a.svgDataRoot.append("g").attr("class","data");return Object.defineProperty(o,"me",{enumerable:!1,get:function(){return i},set:function(t){i=t,a.me=t}}),a.draw=r,o},M.chart.energyIOBarChart=function(t,e){function n(t){var e=h.config.seasonColors||["#5c8726","#e9a712","#762123","#80a3b7"],n=t.date.getUTCMonth();return 2>n||11==n?x?e[3]:e[1]:5>n?x?e[0]:e[2]:8>n?x?e[1]:e[3]:x?e[2]:e[0]}function r(t){return"Month"===h.aggregate()?n(t):null}function a(){var t;return t=1===h.yScale()?",d":",.1f",d3.format(t)}function o(t){var e,n,r,a,o,i=null,u=null,s=null,l=t.length,c=!1;for(r=0;l>r;r+=1)e=t[r],n=e[h.plotPropertyName],void 0!==n&&(a=e[h.internalPropName].groupId,o=h.scaleFactor(a),c=b[a]===!0,c?s+=n*o:u+=n*o);return(null!==u||null!==s)&&(i=u-s),{date:t[0].date,y:i,plus:u,minus:s}}function i(){var t,e,n=[],r=h.groupIds,a=0,i=0,u=h.aggregate();r.forEach(function(t){var e=h.groupLayers[t];void 0===e?n.push([]):n.push(e.map(function(e){var n=d3.max(e.values,function(t){return t.y+t.y0});return b[t]===!0?n>i&&(i=n):n>a&&(a=n),e.values}))});var s=d3.merge(d3.merge(n)).concat(h.xBar.domain().map(function(t){return{date:t}}));return t=d3.nest().key(function(t){return t.date.getTime()}).sortKeys(d3.ascending).rollup(o).entries(s).map(function(t){return t.values}),e=d3.nest().key(function(t){var e;return e="Day"===u?d3.time.month.utc.floor(t.date):"Month"===u?d3.time.month.utc.offset(t.date,-((t.date.getUTCMonth()+1)%3)):d3.time.day.utc.floor(t.date),e.getTime()}).sortKeys(d3.ascending).rollup(o).entries(s).map(function(t){return t.values.date=new Date(Number(t.key)),t.values}),{allData:s,groupedData:n,sumLineData:t,timeAggregateData:e,maxPositiveY:a,maxNegativeY:i}}function u(){function t(t,e){var n=0;return b[o[e]]===!0?(n=-(2*r),"scale(1, -1) translate(0,"+n+")"):null}var e,n,r,a,o=h.groupIds,u=h.transitionMs(),d=h.y.domain();h.computeDomainX(),a=i(),A=a,d[0]=-a.maxNegativeY,d[1]=a.maxPositiveY,h.y.domain(d).nice(),r=h.y(0),e=D.selectAll("g.dataType").data(a.groupedData,function(t,e){return o[e]}),e.transition().duration(u).attr("transform",t),e.enter().append("g").attr("class","dataType").attr("transform",t),n=e.selectAll("g.source").data(Object,function(t){return t[0].sourceId}).style("fill",h.groupFillFn),n.enter().append("g").attr("class","source").style("fill",h.groupFillFn),n.exit().transition().duration(u).style("opacity",1e-6).remove(),h.drawBarsForSources(n),s(a.sumLineData),l(a.timeAggregateData),c(a.timeAggregateData),h.drawAxisY(),h.drawAxisX(),h.drawAxisXRules(a.timeAggregateData)}function s(t){function e(t){return null!==t.y}var n=h.transitionMs(),r=d3.svg.line().x(h.valueXMidBar).y(function(t){return h.y(t.y)-.5}).interpolate("monotone").defined(e),a=k.selectAll("path").data([t]);a.transition().duration(n).attr("d",r),a.enter().append("path").attr("d",d3.svg.line().x(h.valueXMidBar).y(function(){return h.y(0)-.5}).interpolate("monotone").defined(e)).transition().duration(n).attr("d",r),a.exit().transition().duration(n).style("opacity",1e-6).remove()}function l(t){function e(t){var e=h.valueXMidBar(t);return e}function r(t){return m((t.plus-t.minus)/h.yScale())}var o,i=h.transitionMs(),u=h.x.domain(),s=h.xBar,l=t.length;o="Month"===h.aggregate()&&l>0?t:[];var c=s.rangeBand(),d=h.xBarPadding()/2,f=C.selectAll("line").data(o,h.keyX),p=function(t){t.attr("x1",function(t){var e=t.date;return e.getTime()<u[0].getTime()&&(e=u[0]),s(e)-d}).attr("x2",function(t,e){return e+1<o.length?s(o[e+1].date)-d:o.length>0?s(u[1])+c+d:s(t.date)+d}).style("stroke",n)};f.transition().duration(i).call(p),f.enter().append("line").style("opacity",1e-6).call(p).transition().duration(i).style("opacity",1).each("end",function(){d3.select(this).style("opacity",null)}),f.exit().transition().duration(i).style("opacity",1e-6).remove();var m=a(),v=T.selectAll("text").data(h.trimToXDomain(o),h.keyX);v.transition().duration(i).attr("x",e).text(r),v.enter().append("text").style("opacity",1e-6).attr("x",e).transition().duration(i).style("opacity",1).text(r).each("end",function(){d3.select(this).style("opacity",null)}),v.exit().transition().duration(i).style("opacity",1e-6).remove()}function c(t){function e(t){return u(t.plus/h.yScale())}var n,o,i=h.transitionMs(),u=a();o=h.trimToXDomain(t),n=I.selectAll("text").data(o,h.keyX),n.transition().duration(i).attr("x",h.valueXMidBar).text(e).style("fill",r),n.enter().append("text").attr("x",h.valueXMidBar).style("opacity",1e-6).style("fill",r).transition().duration(i).text(e).style("opacity",1).each("end",function(){d3.select(this).style("opacity",null)}),n.exit().transition().duration(i).style("opacity",1e-6).remove()}function d(t){if(A){var e=h.xBar.range(),n=d3.bisectLeft(e,t[0]),r=1>n?0:n-1,a=h.xBar.domain()[r],o=[],i=[],u={data:i,yRange:[h.y(0),h.y(0)],allData:o,groups:{}};return A.groupedData.forEach(function(t,e){var n,r,s={groupId:h.groupIds[e],data:[],negate:b[h.groupIds[e]]===!0},l=h.scaleFactor(s.groupId),c=0;t.length>0&&t[0].length>0&&(r=R(t[0],a),r>=t[0].length&&(r-=1),s.index=r,t.forEach(function(t){t[r].date.getTime()===a.getTime()?(n=t[r][h.plotPropertyName]*l,void 0===u.dateUTC&&t[r].created&&(u.dateUTC=t[r].created,u.utcDate=M.timestampFormat.parse(u.dateUTC))):n=null,c+=n,s.data.push(n),o.push(n)}),s.total=c,s.y=h.y(c),s.y<u.yRange[0]&&(u.yRange[0]=s.y),s.y>u.yRange[1]&&(u.yRange[1]=s.y)),i.push(s),u.groups[s.groupId]=s}),u.date=a,u.x=h.valueXMidBar({date:a}),u.index=r,void 0===u.utcDate&&A.groupedData.some(function(t){return t.some(function(t){var e,n=t.length>0?t[0]:void 0,a=-1,o=d3.time.month,i=1,s=h.aggregate();return n&&n.date&&n.created&&(h.xBar.domain().some(function(t,e){return t.getTime()===n.date.getTime()?(a=e,!0):!1}),a>=0)?(e=M.timestampFormat.parse(n.created),"Day"===s?o=d3.time.day:"Hour"===s?o=d3.time.hour:"FiveMinute"===s?(o=d3.time.minute,i=5):"TenMinute"===s?(o=d3.time.minute,i=10):"FifteenMinute"===s&&(o=d3.time.minute,i=15),u.utcDate=o.offset(e,i*(r-a)),!0):!1})}),u}}function f(){var t=h.hoverEnterCallback();if(t){var e=M.tapCoordinates(this),n=d(e);if(!n)return void(P=void 0);h.drawHoverHighlightBars(n&&n.dateUTC?[n]:[]),P=n,t.call(h.me,this,e,n)}}function p(){var t=h.hoverMoveCallback();if(t){var e=M.tapCoordinates(this),n=d(e);if(!n)return void(P=void 0);h.drawHoverHighlightBars(n&&n.dateUTC?[n]:[]),P=n,w.length>0&&(n.date>w[0].date?h.drawSelection(w.concat(n)):h.drawSelection([n,w[0]])),t.call(h.me,this,e,n)}}function m(){var t=h.hoverLeaveCallback();if(t){var e=[];this&&(e.push(this),e.push(M.tapCoordinates(this))),h.drawHoverHighlightBars([]),P=void 0,t.apply(h.me,e)}}function v(){var t=h.doubleClickCallback();if(t){var e=M.tapCoordinates(this),n=P;n||(n=d(e)),w.length>0&&(w.length=0,h.drawSelection(w)),d3.event.preventDefault(),t.call(h.me,this,e,n)}}function g(){var t=h.rangeSelectionCallback();if(t){var e,n=M.tapCoordinates(this),r=P;r||(r=d(n)),r&&((M.hasTouchSupport||d3.event.shiftKey)&&w.length>0?r.date>w[0].date?w.push(r):w.splice(0,0,r):w.length>0?w.length=0:w.push(r),e=w,w.length>1&&(e=w.slice(0,w.length),w.length=0),h.drawSelection(w),d3.event.preventDefault(),t.call(h.me,this,n,e))}}e&&e.padding||e.value("padding",[20,0,30,30]);var h=M.chart.baseGroupedStackTimeBarChart(t,e),y=function(){var t=M.util.copy(h);return Object.defineProperty(t,"version",{value:"1.0.0",enumerable:!0,configurable:!0}),t}();h.me=y;var x=void 0,b={Consumption:!0},C=h.svgDataRoot.append("g").attr("class","agg-band").attr("transform","translate(0,"+(h.height+h.padding[2]-25)+".5)"),T=h.svgDataRoot.append("g").attr("class","agg-band-ticks").attr("transform","translate(0,"+(h.height+h.padding[2]-21)+")"),D=h.svgDataRoot.append("g").attr("class","data"),k=h.svgDataRoot.append("g").attr("class","agg-sum"),I=h.svgDataRoot.append("g").attr("class","agg-gen").attr("transform","translate(0,"+(10-h.padding[0])+")"),A=void 0,P=void 0,w=[],R=d3.bisector(function(t){return t.date}).left;return y.showSumLine=function(t){if(!arguments.length)return!k.classed("off");var e=h.transitionMs();return k.style("opacity",t?1e-6:1).classed("off",!1).transition().duration(e).style("opacity",t?1:1e-6).each("end",function(){d3.select(this).style("opacity",null).classed("off",!t)}),h.me},y.northernHemisphere=function(t){if(!arguments.length)return x;if(t!==x){var e=h.transitionMs();return x=t===!0,C.selectAll("line").transition().duration(e).style("stroke",n),I.selectAll("text").transition().duration(e).style("fill",r),h.me}},y.negativeGroupIds=function(t){return arguments.length?(b={},t.forEach(function(t){b[t]=!0}),h.me):function(){var t,e=[];for(t in b)b.hasOwnProperty(t)&&e.pus(t);return e}()},h.draw=u,h.handleHoverEnter=f,h.handleHoverMove=p,h.handleHoverLeave=m,h.handleClick=g,h.handleDoubleClick=v,y},M.chart.energyIOPieChart=function(t,e){function n(t){return"scale(1.05) "+y(t,4)}function r(){return P||(P=A.append("g").attr("class","hover-root").attr("transform","translate("+L[3]+","+L[0]+")")),P}function a(t){var e=t.data()[0],n=v(e),r=g(e);return{groupId:e.data.groupId,sourceId:e.data.sourceId,allData:et.map(function(t){return t.data}),value:e.value,valueDisplay:x(e),percent:e.value/nt,percentDisplay:b(e),totalValue:nt,totalValueDisplay:ct(nt/lt),angle:n,angleStart:e.startAngle,angleEnd:e.endAngle,degrees:M.rad2deg(n),radius:S,innerRadius:rt,center:[(F+L[1]+L[3])/2,(E+L[0]+L[2])/2],centerContainer:A.node(),labelTranslate:[Math.cos(r)*(S+15),Math.sin(r)*(S+15)]}}function o(t,e){return t.key.localeCompare(e.key)}function i(){H=O.value("transitionMs")||600,rt=O.value("innerRadius")||0,at.innerRadius(rt).outerRadius(S)}function u(t){return t.value}function s(){var t,e=d3.max(et,u);lt=1,_?lt=_.call(w,e):e>=1e9?lt=1e9:e>=1e6?lt=1e6:e>=1e3&&(lt=1e3),t=lt>=1e6?",.2f":1e3===lt?",.1f":1===lt?",d":",g",ct=d3.format(t),nt=d3.sum(et,u)}function l(){var t=[];tt.forEach(function(e){var n=function(t,n){return Y?Y.call(w,e,t,n):(e+"-"+t.sourceId).replace(/\W/,"-")},r=d3.nest().key(n).rollup(function(t){var n={sum:0,groupId:e};return t.length&&(n.sourceId=t[0].sourceId,n.sum=d3.sum(t,function(t){var n=t[j];return(n&&0>n||G&&G.call(w,e,t.sourceId))&&(n=0),n})*w.scaleFactor(e)),n}).entries($[e]);G&&(r=r.filter(function(t){return!G.call(w,e,t.key)})),t=t.concat(r.map(function(t){return t.values.key=t.key,t.values}))});var e=d3.layout.pie().sort(W).value(function(t){return t.sum});et=e(t),s()}function c(t,e){if(K)return K.call(w,t.data.groupId,t.data.sourceId,e);var n=d3.scale.category10().range();return n[e%n.length]}function d(){d3.select(this).style("opacity",null)}function f(t){var e=d3.interpolate(this._data_start.startAngle,t.startAngle),n=d3.interpolate(this._data_start.endAngle,t.endAngle);return this._data_start=t,function(t){var r={startAngle:e(t),endAngle:n(t)};return at(r)}}function p(t){return t.data.key}function m(){var t=B.selectAll("path").data(et,p);t.transition().duration(H).attr("d",at).style("fill",c).attrTween("d",f),t.enter().append("path").attr("class",function(t){return"area "+t.data.key}).style("fill",c).style("opacity",1e-6).attr("d",at).attr("pointer-events","all").on("mouseover",ot).on("mousemove",it).on("mouseout",ut).on(M.tapEventNames.click,st).each(function(t){this._data_start=t}).transition().duration(H).style("opacity",1).each("end",d),t.exit().transition().duration(H).style("opacity",1e-6).remove(),I()}function v(t){return t.startAngle+(t.endAngle-t.startAngle)/2}function g(t){return v(t)-Math.PI/2}function h(t,e){var n=d3.interpolate(v(this._data_start),v(t));return this._data_start=t,function(t){var r=n(t)-Math.PI/2;return"translate("+Math.cos(r)*e+","+Math.sin(r)*e+")"}}function y(t,e){var n=g(t);return"translate("+Math.cos(n)*e+","+Math.sin(n)*e+")"}function x(t){return ct(t.value/lt)}function b(t){return J(t.value/nt)}function C(t){var e=v(t);return e<2*Math.PI*(1/8)||e>2*Math.PI*(7/8)?"middle":e<2*Math.PI*(3/8)?"start":e<2*Math.PI*(5/8)?"middle":"end"}function T(t){var e=v(t);return e>=2*Math.PI*(3/8)&&e<2*Math.PI*(5/8)?"0.5em":0}function D(){var t=Number(O.value("percentageLabelMinimumPercent"));return(isNaN(t)?5:t)/100*nt}function k(){var t=Number(O.value("valueLabelMinimumPercent"));return(isNaN(t)?5:t)/100*nt}function I(){var t=k(),e=O.enabled("hideValues")?[]:et.filter(function(e){return e.value>t}),n=z.selectAll("text.outer").data(e,p);n.transition().duration(H).text(x).attr("text-anchor",C).attr("dy",T).attr("transform",function(t){return y(t,S+15)}).attrTween("transform",function(t){return h.call(this,t,S+15)}),n.enter().append("text").classed("outer",!0).attr("transform",function(t){return y(t,S+15)}).attr("text-anchor",C).attr("dy",T).style("opacity",1e-6).text(x).each(function(t){this._data_start=t}).transition().duration(H).style("opacity",1).each("end",d),n.exit().transition().duration(H).style("opacity",1e-6).remove();var r=D(),a=O.enabled("hidePercentages")?[]:et.filter(function(t){return t.value>r}),o=z.selectAll("text.inner").data(a,p),i=(S-rt)/2+rt;o.transition().duration(H).text(b).attr("transform",function(t){return y(t,i)}).attrTween("transform",function(t){return h.call(this,t,i)}),o.enter().append("text").classed("inner",!0).attr("transform",function(t){return y(t,i)}).attr("text-anchor","middle").style("opacity",1e-6).text(b).each(function(t){this._data_start=t}).transition().duration(H).style("opacity",1).each("end",d),o.exit().transition().duration(H).style("opacity",1e-6).remove()}var A,P,w={version:"1.0.0"},R=w,U=[],O=e||new M.Configuration,N=M.pixelWidth(t),L=O.padding||[24,24,24,24],F=(O.width||N||300)-L[1]-L[3],E=(O.height||300)-L[0]-L[2],S=d3.min([F,E])/2,H=void 0,j="wattHours",B=void 0,z=void 0,X={},K=void 0,G=void 0,_=void 0,Y=void 0,W=o,q=void 0,Q=void 0,V=void 0,Z=void 0,J=d3.format(".0%"),$={},tt=[],et=void 0,nt=0,rt=0,at=d3.svg.arc(),ot=function(){if(q){var t=d3.select(this),e=d3.mouse(this),r=a(t,e);t.transition().duration(H).attr("transform",n),q.call(R,this,e,r)}},it=function(){if(Q){var t=d3.select(this),e=d3.mouse(this),n=a(t,e);Q.call(R,this,e,n)}},ut=function(){if(V){var t=d3.select(this),e=d3.mouse(this),n=a(t,e);t.transition().duration(H).attr("transform","identity").each("end",function(){d3.select(this).style("transform",null)}),V.call(R,this,e,n)}},st=function(){if(Z){var t=d3.select(this),e=d3.mouse(this),n=a(t,e);Z.call(R,this,e,n)}};i(),A=d3.select(t).select("svg"),A.empty()?A=d3.select(t).append("svg:svg").attr("class","chart").attr("width",F+L[1]+L[3]).attr("height",E+L[0]+L[2]):A.selectAll("*").remove(),B=A.append("g").attr("class","data").attr("transform","translate("+(F+L[1]+L[3])/2+","+(E+L[0]+L[2])/2+")"),z=A.append("g").attr("class","label").attr("transform","translate("+(F+L[1]+L[3])/2+","+(E+L[0]+L[2])/2+")");var lt=1,ct=d3.format(",d");return w.sources=U,w.scale=function(){return _?_():lt},w.totalValue=function(){return nt},w.reset=function(){return $={},tt=[],et=void 0,R},w.load=function(t,e){return void 0===$[e]?(tt.push(e),$[e]=t):$[e].concat(t),R},w.regenerate=function(){return void 0===$?w:(i(),l(),m(),R)},w.transitionMs=function(t){return arguments.length?(H=+t,R):H},w.plotProperty=function(t){return arguments.length?(j=t,R):j},w.scaleFactor=function(t,e){var n;if(!arguments.length)return X;if(1===arguments.length){if("string"==typeof t)return n=X[t],void 0===n?1:n;X=t}else 2==arguments.length&&(X[t]=e);return R},w.colorCallback=function(t){return arguments.length?(K="function"==typeof t?t:void 0,R):K},w.displayFactorCallback=function(t){return arguments.length?(_="function"==typeof t?t:void 0,R):_},w.sourceExcludeCallback=function(t){return arguments.length?(G="function"==typeof t?t:void 0,R):G},w.layerKeyCallback=function(t){return arguments.length?("function"==typeof t&&(Y=t),R):Y},w.layerKeySort=function(t){return arguments.length?("function"==typeof t&&(W=t),R):W},w.hoverEnterCallback=function(t){return arguments.length?(r(),q="function"==typeof t?t:void 0,R):q},w.hoverMoveCallback=function(t){return arguments.length?(r(),"function"==typeof t?(r(),Q=t):Q=void 0,R):Q},w.hoverLeaveCallback=function(t){return arguments.length?(r(),V="function"==typeof t?t:void 0,R):V},w.clickCallback=function(t){return arguments.length?(Z="function"==typeof t?t:void 0,R):Z},w},M.chart.gauge=function(t,e){function n(t){var e=v(t),n=l.minAngle+e*c;return n}function r(t){var e=void 0;for(e in t)l[e]=t[e];c=l.maxAngle-l.minAngle,d=l.size/2,f=Math.round(d*l.pointerHeadLengthPercent),v=d3.scale.linear().range([0,1]).domain([l.minValue,l.maxValue]),g=v.ticks(l.majorTicks),h=d3.range(l.majorTicks).map(function(){return 1/l.majorTicks}),m=d3.svg.arc().innerRadius(d-l.ringWidth-l.ringInset).outerRadius(d-l.ringInset).startAngle(function(t,e){var n=t*e;return M.deg2rad(l.minAngle+n*c)}).endAngle(function(t,e){var n=t*(e+1);return M.deg2rad(l.minAngle+n*c)})}function a(){return"translate("+d+","+d+")"}function o(){return void 0!==p}function i(e){p=d3.select(t).append("svg:svg").attr("class","gauge").attr("width",l.clipWidth).attr("height",l.clipHeight);var r=a(),o=p.append("g").attr("class","arc").attr("transform",r);o.selectAll("path").data(h).enter().append("path").attr("fill",function(t,e){return l.arcColorFn(t*e)}).attr("d",m);var i=p.append("g").attr("class","label").attr("transform",r);i.selectAll("text").data(g).enter().append("text").attr("transform",function(t){var e=n(t);return"rotate("+e+") translate(0,"+(l.labelInset-d)+")"}).text(l.labelFormat);var s=[[l.pointerWidth/2,0],[0,-f],[-(l.pointerWidth/2),0],[0,l.pointerTailLength],[l.pointerWidth/2,0]],c=d3.svg.line().interpolate("monotone"),v=p.append("g").data([s]).attr("class","pointer").attr("transform",r);y=v.append("path").attr("d",c).attr("transform","rotate("+l.minAngle+")"),u(void 0===e?0:e)}function u(t,e){void 0!==e&&r(e);var a=n(t);y.transition().duration(l.transitionMs).ease("elastic").attr("transform","rotate("+a+")")}var s={version:"1.0.0"},l={size:200,clipWidth:200,clipHeight:110,ringInset:20,ringWidth:20,pointerWidth:10,pointerTailLength:5,pointerHeadLengthPercent:.9,minValue:0,maxValue:10,minAngle:-90,maxAngle:90,transitionMs:750,majorTicks:5,labelFormat:d3.format(",g"),labelInset:10,arcColorFn:d3.interpolateHsl(d3.rgb("#e8e2ca"),d3.rgb("#3e6c0a"))},c=void 0,d=void 0,f=void 0,p=void 0,m=void 0,v=void 0,g=void 0,h=void 0,y=void 0;return s.configure=r,s.isRendered=o,s.render=i,s.update=u,r(e),s},M.chart.powerAreaChart=function(t,e){function n(t,e){return o.fillColor.call(this,t[0][o.internalPropName].groupId,t[0],e)}function r(){var t,e,n,r,a,i=[],s=o.plotPropertyName,l=d3.layout.stack().offset(u.stackOffset()).values(function(t){return t.values}).x(function(t){return t.date}).y(function(t){var e=t[s],n=o.scaleFactor(t[o.internalPropName].groupId);return(void 0===e||0>e||null===e)&&(e=0),e*n});o.groupIds.forEach(function(t){var e,n,r,a=u.data(t);if(a&&!(!a.length>1))for(e=0,n=a.length;n>e;e+=1)r=a[e],r.hasOwnProperty(o.internalPropName)||(r[o.internalPropName]={},r[o.internalPropName].groupId=t,u.dataCallback()?u.dataCallback().call(o.me,t,r):void 0===r.date&&(r.date=M.datum.datumDate(r))),u.sourceExcludeCallback()&&u.sourceExcludeCallback().call(o.me,t,r.sourceId)||i.push(r)}),t=d3.nest().key(function(t){return t[o.internalPropName].groupId+"|"+t.sourceId}).sortKeys(d3.ascending).entries(i),t.length<1||(e={},e[s]=null,M.nestedStackDataNormalizeByDate(t,e,function(t,e){var n=e.indexOf("|");t[o.internalPropName]={groupId:e.slice(0,n)},t.sourceId=e.slice(n+1)}),o.insertNormalizedDurationIntoLayerData(t),o.me.layerPostProcessCallback()&&(t=function(){var e=[];return o.groupIds.forEach(function(n){var r=t.filter(function(t){return 0===t.key.indexOf(n+"|")});r.length>0&&(e=e.concat(o.me.layerPostProcessCallback().call(o.me,n,r)))}),e}()),n=i.length>0?[i[0].date,i[i.length-1].date]:void 0,a=l(t),o.groupLayers.All=a,r=[0,d3.max(a[a.length-1].values,function(t){return t.y0+t.y})],void 0!==n&&o.x.domain(n),void 0!==r&&o.y.domain(r).nice(),o.computeUnitsY())}function a(){var t=o.transitionMs(),e=o.groupLayers.All,r=e?e.map(function(t){return t.values}):[],a=o.svgDataRoot.selectAll("path.area").data(r,function(t){return t.length?t[0][o.internalPropName].groupId+"-"+t[0].sourceId:null});a.transition().duration(t).attr("d",s).style("fill",n),a.enter().append("path").attr("class","area").style("fill",n).attr("d",s).style("opacity",1e-6).transition().duration(t).style("opacity",1),a.exit().transition().duration(t).style("opacity",1e-6).remove(),i()}var o=M.chart.baseGroupedStackTimeChart(t,e),i=M.util.superMethod.call(o,"draw"),u=function(){var t=M.util.copy(o);return t}();o.me=u;var s=d3.svg.area().interpolate("monotone").x(function(t){return o.x(t.date)}).y0(function(t){return o.y(t.y0)}).y1(function(t){return o.y(t.y0+t.y)});return o.setup=r,o.draw=a,u},M.chart.powerAreaOverlapChart=function(t,e){function n(t,e){return o.fillColor.call(this,t[0][o.internalPropName].groupId,t[0],e)}function r(t,e,n){return o.groupOpacityFn(null,n)}function a(){var t=[],e=[],a=o.groupIds,u=o.transitionMs();a.forEach(function(n){var r=o.groupLayers[n];if(void 0!==r){e.push(n);var a=r.map(function(t){return t.values});t.push(a)}});var l=o.svgDataRoot.selectAll("g.data").data(t,function(t,n){
return e[n]});l.enter().append("g").attr("class","data"),l.exit().transition().duration(u).style("opacity",1e-6).remove();var c=l.selectAll("path.area").data(Object,function(t){return t.length?t[0][o.internalPropName].groupId+"."+t[0].sourceId:null});c.transition().duration(u).delay(200).attr("d",s).style("fill",n),c.enter().append("path").attr("class","area").style("fill",n).attr("d",s).style("opacity",1e-6).transition().duration(u).style("opacity",r),c.exit().transition().duration(u).style("opacity",1e-6).remove(),i()}var o=M.chart.baseGroupedStackTimeChart(t,e),i=M.util.superMethod.call(o,"draw"),u=function(){var t=M.util.copy(o);return t}();o.me=u;var s=d3.svg.area().interpolate("monotone").x(function(t){return o.x(t.date)}).y0(function(t){return o.y(t.y0)}).y1(function(t){return o.y(t.y0+t.y)});return o.draw=a,o.normalizeDataTimeGaps(!0),u},M.chart.powerIOAreaChart=function(t,e){function n(t,e){return s.fillColor.call(this,t[0][s.internalPropName].groupId,t[0],e)}function r(t){var e,n,r,a,o,i=null,u=null,l=null,c=t.length,d=!1;for(r=0;c>r;r+=1)e=t[r],n=e[s.plotPropertyName],void 0!==n&&(a=e[s.internalPropName].groupId,o=s.scaleFactor(a),d=p[a]===!0,d?l+=n*o:u+=n*o);return(null!==u||null!==l)&&(i=u-l),{date:t[0].date,y:i,plus:u,minus:l}}function a(){var t,e,n=d3.scale.ordinal(),r=s.x,a=s.aggregate(),o=r.domain(),i=1;return"Month"===a?t=d3.time.month.utc:"Day"===a?t=d3.time.day.utc:"Hour"===a?t=d3.time.hour.utc:0===a.search(/^Ten/)?(t=d3.time.minute.utc,i=10):0===a.search(/^Five/)?(t=d3.time.minute.utc,i=5):(t=d3.time.minute.utc,i=15),e=t.range(o[0],t.offset(o[1],i),i),n.domain(e),n}function o(){var t,e=[],n=s.groupIds,o=0,i=0,u=a();n.forEach(function(t){var n=s.groupLayers[t];void 0===n?e.push([]):e.push(n.map(function(e){var n=d3.max(e.values,function(t){return t.y+t.y0});return p[t]===!0?n>i&&(i=n):n>o&&(o=n),e.values}))});var l=d3.merge(d3.merge(e)).concat(u.domain().map(function(t){return{date:t}}));return t=d3.nest().key(function(t){return t.date.getTime()}).sortKeys(d3.ascending).rollup(r).entries(l).map(function(t){return t.values}),{groupedData:e,sumLineData:t,maxPositiveY:o,maxNegativeY:i}}function i(){function t(t,e){var n=0;return p[c[e]]===!0?(n=-(2*a),"scale(1, -1) translate(0,"+n+")"):null}var e,r,a,i,c=s.groupIds,d=s.transitionMs(),m=s.y.domain();i=o(),m[0]=-i.maxNegativeY,m[1]=i.maxPositiveY,s.y.domain(m).nice(),a=s.y(0),e=s.svgDataRoot.selectAll("g.dataType").data(i.groupedData,function(t,e){return c[e]}),e.transition().duration(d).attr("transform",t),e.enter().append("g").attr("class","dataType").attr("transform",t),r=e.selectAll("path.source").data(Object,function(t){return t.length?t[0].sourceId:null}),r.transition().duration(d).attr("d",f).style("fill",n),r.enter().append("path").attr("class","source").style("fill",n).attr("d",f).style("opacity",1e-6).transition().duration(d).style("opacity",1),r.exit().transition().duration(d).style("opacity",1e-6).remove(),u(i.sumLineData),l()}function u(t){function e(t){return null!==t.y}function n(t){return s.x(t.date)}var r=s.transitionMs(),a=d3.svg.line().x(n).y(function(t){return s.y(t.y)-.5}).interpolate("monotone").defined(e),o=d.selectAll("path").data([t]);o.transition().duration(r).attr("d",a),o.enter().append("path").attr("d",d3.svg.line().x(n).y(function(){return s.y(0)-.5}).interpolate("monotone").defined(e)).transition().duration(r).attr("d",a),o.exit().transition().duration(r).style("opacity",1e-6).remove()}var s=M.chart.baseGroupedStackTimeChart(t,e),l=M.util.superMethod.call(s,"draw"),c=function(){var t=M.util.copy(s);return Object.defineProperty(t,"version",{value:"1.0.0",enumerable:!0,configurable:!0}),t}();s.me=c;var d=s.svgRoot.append("g").attr("class","agg-sum").attr("transform",s.svgDataRoot.attr("transform")),f=d3.svg.area().interpolate("monotone").x(function(t){return s.x(t.date)}).y0(function(t){return s.y(t.y0)}).y1(function(t){return s.y(t.y0+t.y)}),p={Consumption:!0};return c.showSumLine=function(t){if(!arguments.length)return!d.classed("off");var e=s.transitionMs();return d.style("opacity",t?1e-6:1).classed("off",!1).transition().duration(e).style("opacity",t?1:1e-6).each("end",function(){d3.select(this).style("opacity",null).classed("off",!t)}),s.me},c.negativeGroupIds=function(t){return arguments.length?(p={},t.forEach(function(t){p[t]=!0}),s.me):function(){var t,e=[];for(t in p)p.hasOwnProperty(t)&&e.pus(t);return e}()},s.draw=i,s.normalizeDataTimeGaps(!0),c},M.chart.seasonalDayOfWeekLineChart=function(t,e){var n=M.chart.baseGroupedSeasonalLineChart(t,e),r=function(){var t=M.util.copy(n);return Object.defineProperty(t,"version",{value:"1.0.0",enumerable:!0,configurable:!0}),t}();return n.me=r,n.timeKeyLabels(["Mon","Tue","Wed","Thu","Fri","Sat","Sun"]),n.xAxisTicks=function(){return n.x.domain()},n.dateForTimeKey=function(t){return new Date(Date.UTC(2001,0,1+t))},n.timeKeyForDate=function(t){return(t.getUTCDay()+6)%7},n.timeKeyInterval=function(){return d3.time.day.utc},r},M.chart.seasonalHourOfDayLineChart=function(t,e){var n=M.chart.baseGroupedSeasonalLineChart(t,e),r=function(){var t=M.util.copy(n);return Object.defineProperty(t,"version",{value:"1.0.0",enumerable:!0,configurable:!0}),t}();return n.me=r,n.timeKeyLabels(["Midnight","1am","2am","3am","4am","5am","6am","7am","8am","9am","10am","11am","Noon","1pm","2pm","3pm","4pm","5pm","6pm","7pm","8pm","9pm","10pm","11pm"]),n.xAxisTicks=function(){return n.x.domain().filter(function(t,e){return e%2===0})},n.dateForTimeKey=function(t){return new Date(Date.UTC(2001,0,1,t))},n.timeKeyForDate=function(t){return t.getUTCHours()},n.timeKeyInterval=function(){return d3.time.hour.utc},r},M.color={steelblue:["#356287","#4682b4","#6B9BC3","#89AFCF","#A1BFD9","#B5CDE1","#DAE6F0"],triplets:["#3182bd","#6baed6","#9ecae1","#e6550d","#fd8d3c","#fdae6b","#31a354","#74c476","#a1d99b","#756bb1","#9e9ac8","#bcbddc","#843c39","#ad494a","#d6616b","#8c6d31","#bd9e39","#e7ba52","#7b4173","#a55194","#ce6dbd"],seasonColors:["#5c8726","#e9a712","#762123","#80a3b7"]},M.runtime={},M.color.map=T,M.color.color=D,M.counter=k,M.hasTouchSupport=function(){if(!U||!U.document)return!1;if("createTouch"in U.document)return!0;try{var t=U.document.createEvent("TouchEvent");return!!t.initTouchEvent}catch(e){return!1}}(),M.format.fmt=I,M.math={deg2rad:A,rad2deg:P},M.net.encodeURLQueryTerms=w,M.net.securityHelper=function(){function t(){return d.token&&d.token.length>0&&d.secret&&d.secret.length>0}function e(t){return arguments.length?(d.token=t&&t.length>0?t:void 0,M.sec):d.token}function n(t){return arguments.length&&(d.secret=t),M.sec}function r(){return d.secret&&d.secret.length>0}function a(){return d.secret=void 0,M.sec}function o(t){return null!==t&&t.indexOf("application/x-www-form-urlencoded")<0}function i(t){var e=(void 0===t.method?"GET":t.method.toUpperCase())+"\n"+(void 0!==t.data&&o(t.contentType)?CryptoJS.MD5(t.data):"")+"\n"+(void 0===t.contentType?"":t.contentType)+"\n"+t.date+"\n"+t.path,n=CryptoJS.HmacSHA1(e,t.secret||""),r=t.token+":"+CryptoJS.enc.Base64.stringify(n);return r}function u(t){var e,n,r,a,o={};if(void 0!==t&&t.length>0)for(t.match(/^\?/)&&(t=t.substring(1)),e=t.split("&"),r=0,a=e.length;a>r;r++)n=e[r].split("=",2),2===n.length&&(o[decodeURIComponent(n[0])]=decodeURIComponent(n[1]));return o}function s(t,e){var n=document.createElement("a");n.href=t;var r,a,o=n.pathname,i=M.sec.parseURLQueryTerms(void 0===e?n.search:e),u=[],s=void 0,l=!0;o.length>0&&"/"!==o.charAt(0)&&(o="/"+o);for(s in i)u.push(s);if(u.sort(),u.length>0)for(o+="?",r=0,a=u.length;a>r;r++)l?l=!1:o+="&",o+=u[r],o+="=",o+=i[u[r]];return o}function l(t,e,n,r,a){var i=t;arguments.length>0&&(arguments.length<5&&"function"==typeof arguments[arguments.length-1]&&(a=arguments[arguments.length-1]),"string"!=typeof e&&(e=void 0),"string"!=typeof n&&(n=void 0),"string"!=typeof r&&(r=void 0)),e=void 0===e?"GET":e.toUpperCase(),("POST"===e||"PUT"===e)&&(n||!function(){var e=t.indexOf("?");-1!==e&&(e+1<t.length-1&&(n=t.substring(e+1)),i=t.substring(0,e),r="application/x-www-form-urlencoded; charset=UTF-8")}());var u=d3.json(i);return void 0!==r&&u.header("Content-Type",r),u.on("beforesend",function(a){var i=(new Date).toUTCString(),u=M.sec.authURLPath(t,void 0!==r&&0===r.indexOf("application/x-www-form-urlencoded")?n:void 0),s=M.sec.generateAuthorizationHeaderValue({method:e,date:i,path:u,token:d.token,secret:d.secret,data:n,contentType:r});void 0!==n&&o(r)&&a.setRequestHeader("Content-MD5",CryptoJS.MD5(n)),a.setRequestHeader("X-SN-Date",i),a.setRequestHeader("Authorization","SolarNetworkWS "+s)}),u.on("load.internal",function(){}),void 0!==a&&u.send(e,n,a),u}var c={version:"1.1.0"},d={token:void 0,secret:void 0};return Object.defineProperties(c,{hasTokenCredentials:{value:t},token:{value:e},secret:{value:n},hasSecret:{value:r},clearSecret:{value:a},generateAuthorizationHeaderValue:{value:i},parseURLQueryTerms:{value:u},authURLPath:{value:s},json:{value:l}}),c},M.net.sec=M.net.securityHelper(),M.ui={},M.ui.flipCounter=function(t,e){function n(t){var e=void 0;for(e in t)u[e]=t[e]}function r(e){s=d3.select(t).classed("flipCounter",!0),o(void 0===e?0:e)}function a(t,e){return u.flipperWidth*(l.length-1)-u.flipperWidth*e+"px"}function o(t){var e=u.format(t);l=function(){var t,n,r=[];for(t=0,n=e.length;n>t;t++)r.push(e.charAt(t));return r.reverse()}();var n=s.selectAll("span.flipper").data(l);n.style("left",a).each(function(t){var e=d3.select(this),n=u.animate===!0?e.classed("flipped"):!1,r=e.select(n||u.animate!==!0?"span.a":"span.b"),a=e.select(n?"span.b":"span.a").text();a!==t&&(r.select("span.value").text(t),u.animate&&e.classed("flipped",!n))}),n.enter().append("span").attr("class","flipper").style("left",a).html(function(t){return(u.animate?'<span class="face b"><span class="value">b</span></span>':"")+'<span class="face a"><span class="value">'+t+"</span></span>"}),n.exit().remove()}var i={version:"1.0.0"},u={flipperWidth:34,transitionMs:200,format:d3.format("07,g"),animate:!0},s=void 0,l=["0"];return i.configure=n,i.render=r,i.update=o,n(e),i},M.ui.Matrix=function(){var t="Float32Array"in window;this.matrix=function(){var e;return t?(e=new Float32Array(6),e[0]=1,e[3]=1):e=[1,0,0,1,0,0],e}(),this.support={use3d:this.supportDefaults.use3d,tProp:this.supportDefaults.tProp,trProp:this.supportDefaults.trProp,trTransform:this.supportDefaults.trTransform,trEndEvent:this.supportDefaults.trEndEvent}},M.ui.Matrix.prototype={constructor:M.ui.Matrix,supportDefaults:function(){for(var t=document.createElement("div").style,e="Transform",n=["Webkit"+e,"O"+e,"ms"+e,"Moz"+e],r=["webkitTransitionEnd","oTransitionEnd","transitionend","transitionend"],a=["WebkitTransition","OTransition","transition","MozTransition"],o=["-webkit-transform","-o-transform","transform","-moz-transform"],i="Transform",u="Transition",s="transform",l="transitionEnd",c=n.length;c--;)if(n[c]in t){i=n[c],u=a[c],s=o[c],l=r[c];break}return{use3d:void 0===window.devicePixelRatio?!1:window.devicePixelRatio>1,tProp:i,trProp:u,trTransform:s,trEndEvent:l}}(),toMatrix3D:function(){return"matrix3d("+this.matrix[0]+","+this.matrix[1]+",0,0,"+this.matrix[2]+","+this.matrix[3]+",0,0,0,0,1,0,"+this.matrix[4]+","+this.matrix[5]+",0,1)"},toMatrix2D:function(){return"matrix("+this.matrix[0]+","+this.matrix[1]+","+this.matrix[2]+","+this.matrix[3]+","+this.matrix[4]+","+this.matrix[5]+")"},setRotation:function(t){var e=Math.cos(t),n=Math.sin(t);this.matrix[0]=this.matrix[3]=e,this.matrix[1]=0-n,this.matrix[2]=n},setScale:function(t){this.matrix[0]=t,this.matrix[3]=t},setTranslation:function(t,e){this.matrix[4]=t,this.matrix[5]=e},translate:function(t,e){this.matrix[4]+=t,this.matrix[5]+=e},getTranslation:function(){return{x:this.matrix[4],y:this.matrix[5]}},getDistanceFrom:function(t){return Math.sqrt(Math.pow(t.x-this.matrix[4],2),Math.pow(t.y-this.matrix[5],2))},apply:function(t){var e=this.support.use3d===!0?this.toMatrix3D():this.toMatrix2D();t.style[this.support.tProp]=e},animateListen:function(t,e){var n=void 0,r=this;n=function(a){a.target===t&&(t.removeEventListener(r.support.trEndEvent,n,!1),e.apply(t))},t.addEventListener(r.support.trEndEvent,n,!1)},animate:function(t,e,n,r){var a=this;this.animateListen(t,function(){t.style[a.support.trProp]="",void 0!==r&&r.apply(t)});var o=this.support.trTransform+" "+(void 0!==n?n:"0.3s")+" "+(void 0!==e?e:"ease-out");t.style[this.support.trProp]=o,this.apply(t)},easeOut:function(t,e){this.animate(t,"ease-out",void 0,e)},easeIn:function(t,e){this.animate(t,"ease-in",void 0,e)},isUse3d:function(){return this.support.use3d===!0},setUse3d:function(t){this.support.use3d=t===!0}},"function"==typeof define&&define.amd?define(this.sn=M):"object"==typeof module&&module.exports?module.exports=M:this.sn=M}();
//# sourceMappingURL=solarnetwork-d3.min.js.map
